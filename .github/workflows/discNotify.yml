name: Discord Webhook


on:
  workflow_run:
    workflows: ["Deployment pipeline"]
    types:
      - completed

jobs:
  notify_discord_deploy:
    runs-on: ubuntu-20.04
    needs: deploy
    steps:
      - name: Check deployment status
        id: check_status
        run: echo "::set-output name=deployment-status::${{ needs.tag_release.outputs.deployment-status }}"
      - name: Send Discord notification on success
        uses: rjstone/discord-webhook-notify@v1
        if: steps.check_status.outputs.deployment-status == 'success'
        with:
          severity: info
          description: to https://pokeman-service.onrender.com/
          details: Deployment Succeeded!
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK_URL }}
      - name: Send Discord notification on failure
        uses: rjstone/discord-webhook-notify@v1
        if: steps.check_status.outputs.deployment-status == 'failure'
        with:
          severity: error
          description: Build failed for commit [${GITHUB_SHA::8}](${{ github.event.compare }})
            **Commit details:**
            - **Message:** ${github.event.commits[0].message}
            - **Committer:** ${github.event.commits[0].committer.name}
            - **Commit date:** ${github.event.commits[0].timestamp}

          details: Build failed
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK_URL }}

  notify_discord_simple_deployment_pipeline:
    runs-on: ubuntu-20.04
    needs: simple_deployment_pipeline
    steps:
      - name: Check status
        id: check_status
        run: echo "::set-output name=pipeline-status::${{ needs.tag_release.outputs.pipeline-status }}"
      - name: Send Discord notification on failure
        uses: rjstone/discord-webhook-notify@v1
        if: steps.check_status.outputs.pipeline-status == 'failure'
        with:
          severity: error
          description: Build failed for commit [${GITHUB_SHA::8}](${{ github.event.compare }})
            **Commit details:**
            - **Message:** ${github.event.commits[0].message}
            - **Committer:** ${github.event.commits[0].committer.name}
            - **Commit date:** ${github.event.commits[0].timestamp}

          details: Build failed
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK_URL }}        


  dummy_job:
    runs-on: ubuntu-20.04
    steps:
      - name: Dummy step
        run: echo "This is a dummy job"        